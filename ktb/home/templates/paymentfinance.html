<!DOCTYPE html>
{%load staticfiles%}
{% load custom_tags %}
<html lang="en">
   <head>
      <!-- Required meta tags-->
      <meta charset="UTF-8">
      <meta name="Editport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!-- Title Page-->
      <title>Payment and Finance</title>
      <!-- Fontfaces CSS-->
      <link href="{% static 'home/css/font-face.css' %}" rel="stylesheet" media="all">
      <!-- <link href="{% static 'home/vendor/font-awesome-5/css/fontawesome-all.min.css' %}" rel="stylesheet" media="all"> -->
      <link href="{% static 'home/vendor/font-awesome-4.7/css/font-awesome.min.css'%}" rel="stylesheet" media="all">
      <link href="{% static 'home/vendor/mdi-font/css/material-design-iconic-font.min.css'%}" rel="stylesheet" media="all">
      <!-- Bootstrap CSS-->
      <link href="{% static 'home/vendor/bootstrap-4.1/bootstrap.min.css' %}" rel="stylesheet" media="all">
      <!-- Vendor CSS-->
      <link href="{% static 'home/vendor/css-hamburgers/hamburgers.min.css' %}" rel="stylesheet" media="all">
            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.5.0-RC1/css/bootstrap-datepicker3.standalone.min.css" rel="stylesheet">
      <!-- Main CSS-->
      <link href="{% static 'home/css/style.css' %}" rel="stylesheet" media="all">
      <style type="text/css">
        select#dropdownList {

          right: 50%;

        }
        .filter_year{
          left: 0;
          bottom: -67%;
        }
        input.approved{
          right: 27%;
        }
      </style>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script type="text/javascript">
         $(document).ready(function(){

          var filterDate=false;

          var x= $("#dropdownList option:selected" ).text();
      // alert(x);
      searchrow();
      function searchrow(){
        if(x=='By TRN'){
          // alert(x);
          $(".table-search.approved").on("keyup", function() {
            var value = $(this).val().toLowerCase(),
            tableattr = $(this).attr("data-table-search"),
            tablesearch = $('#' + tableattr).find('tbody tr');
            // alert(value);
            tablesearch.hide();                           //start with all rows hidden
            //initiate our stored rowspan with the default of 1

            tablesearch.each(function() {
              var $row = $(this);
              var $firstCell = $row.find("td:nth-child(4)");
              var id = $firstCell.text().toLowerCase();
              if (id.indexOf(value) > -1) {               //if the text is found
                $row.show();         //show this row, and the next (n-1) rows as well
              }
            });
          });
        }
      }

      $('#dropdownList').on('change',function(){
        var x= $("#dropdownList option:selected" ).text();
        if(x=='By TRN'){
           // alert(x);
          $(".table-search.approved").on("keyup", function() {

            var value = $(this).val().toLowerCase(),
            tableattr = $(this).attr("data-table-search"),
            tablesearch = $('#' + tableattr).find('tbody tr');
            // alert(value);
            tablesearch.hide();                           //start with all rows hidden
            //initiate our stored rowspan with the default of 1

            tablesearch.each(function() {
              var $row = $(this);
              var $firstCell = $row.find("td:nth-child(4)");
              var id = $firstCell.text().toLowerCase();

              // alert($firstCell.toString());
              if (id.indexOf(value) > -1) {               //if the text is found
                $row.show();         //show this row, and the next (n-1) rows as well
              }
            });
          });
        }
        else if(x=='By Party'){
           // alert(x);
          $(".table-search.approved").on("keyup", function() {
            var value = $(this).val().toLowerCase(),
            tableattr = $(this).attr("data-table-search"),
            tablesearch = $('#' + tableattr).find('tbody tr');
            // alert(value);
            tablesearch.hide();                           //start with all rows hidden
            //initiate our stored rowspan with the default of 1

            tablesearch.each(function() {
              var $row = $(this);
              var $firstCell = $row.find("td:nth-child(10)");
              var id = $firstCell.text().toLowerCase();
              // alert($firstCell.toString());
              if (id.indexOf(value) > -1) {               //if the text is found
                $row.show();         //show this row, and the next (n-1) rows as well
              }
            });
          });
        }


      });

          $("#dropdown").change(function(){
            filterDate=false;
                    var id=this.value;

                    $.post("{% url 'home:getfinance'%}",
                    {
                        'type':id,
                    },
                    function(data,status){

                       $('#rowid').empty();
                       for (var i = 0; i < data.data.length; i++) {

                        $("#rowid").append("<tr><th>"+data.trn[i].sn+"</th><td>"+data.trn[i].types+"</td><td>"+data.trn[i].company+"</td><td>"+data.trn[i].trn+"</td><td>"+data.data[i].balancePayment+"</td><td>"+data.data[i].dueDate+"</td><td>"+data.data[i].payment+"</td><td>"+data.data[i].paymentDate+"</td><td>"+data.data[i].balanceDue+"</td><td>"+data.trn[i].client+"</td><td><button type='button' class='btn btn-primary view' id="+data.trn[i].trn+" value="+data.trn[i].trn+" data-toggle='modal' data-target='#view0'>View</button> {% if user.authority != 'Admin' or user.authority != 'Viewer'%}<button type='button' class='btn btn-primary editbtn0' id="+data.trn[i].trn+" value="+data.trn[i].trn+" data-toggle='modal' data-target='#edit0'>Edit</button> {% endif %}{% if user.authority == 'Manager 2' %}<button type='button' class='btn btn-danger delete' value="+data.trn[i].trn+">Delete</button>{% endif %}</td></tr>");
                           //alert(data.data[i].trn);
                       }
                    });
                });

// for date

 $("#paymentduedate-input-date").datepicker({

}).on("changeDate", function (e) {
    var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();


  $('#paymentduedate-input').val(d);
    // console.log(e.date);
    // alert('hi');
});

 $("#paymentdate-input-date").datepicker({

}).on("changeDate", function (e) {
  var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();


  $('#paymentdate-input').val(d);
    // console.log(e.date);
    // alert('hi');
});

$("#duedate_logistic_comissions-input-date").datepicker({

}).on("changeDate", function (e) {
   var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();

  $('#duedate_logistic_comissions-input').val(d);
    // console.log(e.date);
    // alert('hi');
});

$("#duedate_agent_comissions-input-date").datepicker({

}).on("changeDate", function (e) {
    var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();


  $('#duedate_agent_comissions-input').val(d);
    // console.log(e.date);
    // alert('hi');
});

 $("#edit-paymentduedate-input-date").datepicker({

}).on("changeDate", function (e) {
   var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();


  $('#edit-paymentduedate-input').val(d);
    // console.log(e.date);
    // alert('hi');
});

$("#edit-paymentdate-input-date").datepicker({

}).on("changeDate", function (e) {
   var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();


  $('#edit-paymentdate-input').val(d);
    // console.log(e.date);
    // alert('hi');
});

$("#edit-duedate_logistic_comissions-input-date").datepicker({

}).on("changeDate", function (e) {
   var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();

  $('#edit-duedate_logistic_comissions-input').val(d);
    // console.log(e.date);
    // alert('hi');
});

$("#edit-duedate_agent_comissions-input-date").datepicker({

}).on("changeDate", function (e) {
   var d=new Date();
 d = e.date;
d=(d.getDate() ) + '/' + (d.getMonth() + 1)+ '/' +  d.getFullYear();


  $('#edit-duedate_agent_comissions-input').val(d);
    // console.log(e.date);
    // alert('hi');
});


        $('#traderefno').change(function(){
            var trn=this.value;
            var i;
             $.post("{% url 'home:helperpaymentFinance' %}",
               {
                  'traderef': trn,

               },
                function(data,status){
                     // alert("Data: " + data.logisticsandcommissionduedate + "\nStatus: " + status);
                     i=data;
                  $('#tradetype-input').val(data.types);
                  $('#balancepayment-input').val(parseFloat(data.balancepayment).toFixed(2));
                  // $('#paymentduedate-input').val(data.duedate);
                  $('#logisticpaymenttobepaid-input').val(parseFloat(data.logisticsdue).toFixed(2));
                  $('#logisticagent-input').val(data.logisticprovider);
                  $('#comissionagent-input').val(data.commissionagent);
                  $('#agent_commissionamountpaid-input').val(parseFloat(data.agentcommissiondue).toFixed(2));
                  $('#paymentfinanceparty').val(data.client);
                  // $('#duedate_logistic-agent_comissions-input').val(data.logisticsandcommissionduedate);
             });


              //  $("#supplierbalancepayment-input").val(i.salesInvoiceAmount-i.advanceFromBuyers);


              // $("#buyerbalancepayment-input").val(i.purchaseInvoiceAmount-i.advanceToSellers);

                $("#payment-input").keyup(function(){
                $("#balancedue-input").val(parseFloat($("#balancepayment-input").val()-this.value).toFixed(2));
            });
         });

        $("#edit-payment-input").keyup(function(){
                $("#edit-balancedue-input").val(parseFloat($("#edit-balancepayment-input").val()-this.value).toFixed(2));
            });

          $('#tradetype-input').change(function(){
               if(this.value=='Purchase'){

                  $('#payments').text('Balance Payment To Supplier');
                   $('#date').text('Supplier Payment Due Date');
                    $('#payments_made').text('Payment Sent');
               }
                if(this.value=='Sales'){

                 $('#payments').text('Balance Payment from Buyer');
                   $('#date').text('Buyer Payment Due Date');
                    $('#payments_made').text('Payment Received');
               }
            });

      $(document).on('click','.editbtn0',function(){
                  var trn=this.value;
                  $.post("{% url 'home:alterFinance' %}",
                  {
                     'trn':trn
                  },
              function(data,status){
                $('#edit-tradetype-input').val(data.types);
                // alert(data.lcExpiryDate);
               $('#edit-number-input').val(data.sn);
               $('#edit-company-input').val(data.company);
               $('#edit-traderefdate-input').val(data.trd);
               $('#edit-traderefno-input').val(data.trn);
               $('#edit-types-input').val(data.types);
                $('#edit-paymentfinanceparty').val(data.client);
                $('#edit-balancepayment-input').val(parseFloat(data.balancePayment).toFixed(2));
          $('#edit-paymentduedate-input').val(data.dueDate);
          $('#edit-payment-input').val(parseFloat(data.payment).toFixed(2));
          $('#edit-paymentdate-input').val(data.paymentDate);
          $('#edit-balancedue-input').val(parseFloat(data.balanceDue).toFixed(2));

          $('#edit-paymentmode-input').val(data.paymentMode);
          $('#edit-statusofpayments-input').val(data.paymentStatus);
          $('#edit-logisticpaymenttobepaid-input').val(parseFloat(data.logisticsPaymentDue).toFixed(2));
          $('#edit-logisticagent-input').val(data.logisticsProvider);
          $('#edit-comissionagent-input').val(data.commissionAgent);

          $('#edit-duedate_logistic_comissions-input').val(data.logisticsCommissionDueDate);
          $('#edit-duedate_agent_comissions-input').val(data.agentCommissionDueDate);
          $('#edit-agent_commissionamountpaid-input').val(parseFloat(data.agentCommissionPaid).toFixed(2));
          $('#edit-traderefno').val(data.trn);
          $('#edit-salespurchase_remarks-input').val(data.remarks);

             });
            });

          $(document).on('click','.view',function(){
                  var trn=this.value;
                  $.post("{% url 'home:alterFinance' %}",
                  {
                     'trn':trn
                  },
              function(data,status){
                // $('#edit-tradetype-input').val(data.types);
                // alert(data.lcExpiryDate);
               $('#sn').text(data.sn);
               $('#company').text(data.company);
               $('#trd').text(data.trd);
               $('#trn').text(data.trn);
               // $('#edit-types-input').val(data.types);

                $('#balancePayment').text(data.balancePayment.toFixed(2));
          $('#dueDate').text(data.dueDate);
          $('#payment').text(data.payment.toFixed(2));
          $('#paymentDate').text(data.paymentDate);
          $('#balanceDue').text(data.balanceDue.toFixed(2));

          $('#paymentMode').text(data.paymentMode);
          $('#paymentStatus').text(data.paymentStatus);
          $('#logisticsPaymentDue').text(data.logisticsPaymentDue.toFixed(2));
          $('#logisticsProvider').text(data.logisticsProvider);
          $('#commissionAgent').text(data.commissionAgent);

          $('#logisticsCommissionDueDate').text(data.logisticsCommissionDueDate);
          $('#agentCommissionDueDate').text(data.agentCommissionDueDate);
          $('#agentCommissionPaid').text(data.agentCommissionPaid.toFixed(2));
          $('#viewremarks').text(data.remarks);
          // $('#edit-traderefno').val(data.trn);
          if(data.types == 'Sales' || data.types == 'Sales Amendment'){
            $('#supply').text('Balance Payment from Buyer');
            $('#supplydate').text('Buyer Payment Due Date');
            $('#supplypayment').text('Payment Received');
          }
          else{
            $('#supply').text('Balance Payment To Supplier');
            $('#supplydate').text('Supplier Payment Due Date');
            $('#supplypayment').text('Payment Sent');

          }

             });
            });

          $('.delete').click(function(){
                    var trn=this.value;
                    $.post("{% url 'home:delFinance' %}",
                        {
                            'trn':trn
                        },
                        function(data,status){
                            // alert(data.result);
                        });
                });

          $('#filter_btn').on('click','',function(){
            filterDate=true;
            var year=$('#by_year').val();
            var month=$('#by_month').val();

            $.post("{% url 'home:financeDate'%}",
            {
              'year':year,
              'month':month,
            },
            function(data,status){
             $('#rowid').empty();
                       for (var i = 0; i < data.data.length; i++) {

                        $("#rowid").append("<tr><th>"+data.trn[i].sn+"</th><td>"+data.trn[i].types+"</td><td>"+data.trn[i].company+"</td><td>"+data.trn[i].trn+"</td><td>"+data.data[i].balancePayment+"</td><td>"+data.data[i].dueDate+"</td><td>"+data.data[i].payment+"</td><td>"+data.data[i].paymentDate+"</td><td>"+data.data[i].balanceDue+"</td><td>"+data.trn[i].client+"</td><td><button type='button' class='btn btn-primary view' id="+data.trn[i].trn+" value="+data.trn[i].trn+" data-toggle='modal' data-target='#view0'>View</button> {% if user.authority != 'Admin' or user.authority != 'Viewer'%}<button type='button' class='btn btn-primary editbtn0' id="+data.trn[i].trn+" value="+data.trn[i].trn+" data-toggle='modal' data-target='#edit0'>Edit</button> {% endif %}{% if user.authority == 'Manager 2'%}<button type='button' class='btn btn-danger delete' value="+data.trn[i].trn+">Delete</button>{% endif %}</td></tr>");
           }
           });
          });

          $('.excel').click(function(){
            if(filterDate==false){
               if($('#dropdown').val()=='salestrade'){
                        $(this).attr('href',"{% url 'home:exportFinance' approval='salestrade'%}");
                    }
                    else if($('#dropdown').val()=='purchasetrade'){
                        $(this).attr('href',"{% url 'home:exportFinance' approval='purchasetrade'%}");
                    }
                    else if($('#dropdown').val()=='cancelsales'){
                        $(this).attr('href',"{% url 'home:exportFinance' approval='cancelsales'%}");
                    }
                    else if($('#dropdown').val()=='cancelpurchase'){
                        $(this).attr('href',"{% url 'home:exportFinance' approval='cancelpurchase'%}");
                    }
                    else if($('#dropdown').val()=='salesamendment'){
                        $(this).attr('href',"{% url 'home:exportFinance' approval='salesamendment'%}");
                    }
                    else if($('#dropdown').val()=='purchaseamendment'){
                        $(this).attr('href',"{% url 'home:exportFinance' approval='purchaseamendment'%}");
                    }
                    else{
                        $(this).attr('href',"{% url 'home:exportFinance' approval='all'%}");
                    }
                    

            }
            else{
              var year=$('#by_year').val();
              var month=$('#by_month').val();
             $(this).attr('href',"/home/exportfinancefilter/"+year+"/"+month+"/");
            }           
                     });
         });


      function Validate(){
        if($('#tradetype-input').val()!="Sales" && $('#tradetype-input').val()!="Purchase"){
               // alert($('#tradetype-input').val());
               $('#tradetype-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
            }
            else if($('#balancepayment-input').val()==''){
             $('#balancepayment-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#paymentduedate-input').val()==''){
             $('#paymentduedate-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#payment-input').val()==''){
             $('#payment-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#paymentdate-input').val()==''){
             $('#paymentdate-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#balancedue-input').val()==''){
             $('#balancedue-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }

             else if($('#paymentmode-input').val()==''){
             $('#paymentmode-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#statusofpayments-input').val()==''){
             $('#statusofpayments-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#logisticpaymenttobepaid-input').val()==''){
             $('#logisticpaymenttobepaid-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#logisticagent-input').val()==''){
             $('#logisticagent-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#comissionagent-input').val()==''){
             $('#comissionagent-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#duedate_logistic-agent_comissions-input').val()==''){
             $('#duedate_logistic-agent_comissions-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#agent_commissionamountpaid-input').val()==''){
             $('#agent_commissionamountpaid-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#duedate_agent_comissions-input').val()==''){
             $('#duedate_agent_comissions-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
              else if($('#duedate_logistic_comissions-input').val()==''){
             $('#duedate_logistic_comissions-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
              else if($('#salespurchase_remarks-input').val()==''){
             $('#salespurchase_remarks-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else{
              return true;
             }

        }

       function ValidateEdit(){
        if($('#edit-tradetype-input').val()!="Sales" && $('#edit-tradetype-input').val()!="Purchase"){
               // alert($('#tradetype-input').val());
               $('#edit-tradetype-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
            }
            else if($('#edit-balancepayment-input').val()==''){
             $('#edit-balancepayment-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-paymentduedate-input').val()==''){
             $('#edit-paymentduedate-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-payment-input').val()==''){
             $('#edit-payment-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-paymentdate-input').val()==''){
             $('#edit-paymentdate-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-balancedue-input').val()==''){
             $('#edit-balancedue-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }

             else if($('#edit-paymentmode-input').val()==''){
             $('#edit-paymentmode-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-statusofpayments-input').val()==''){
             $('#edit-statusofpayments-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-logisticpaymenttobepaid-input').val()==''){
             $('#edit-logisticpaymenttobepaid-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-logisticagent-input').val()==''){
             $('#edit-logisticagent-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-comissionagent-input').val()==''){
             $('#edit-comissionagent-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-duedate_logistic-agent_comissions-input').val()==''){
             $('#edit-duedate_logistic-agent_comissions-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else if($('#edit-agent_commissionamountpaid-input').val()==''){
             $('#edit-agent_commissionamountpaid-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
              else if($('#edit-duedate_agent_comissions-input').val()==''){
             $('#edit-duedate_agent_comissions-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
              else if($('#edit-duedate_logistic_comissions-input').val()==''){
             $('#edit-duedate_logistic_comissions-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
              else if($('#edit-salespurchase_remarks-input').val()==''){
             $('#edit-salespurchase_remarks-input').css({
                  'background':'#ea4b4b',
                  'color':'#fff'
               });
            return false;
             }
             else{
              return true;
             }

        }



      </script>
   </head>
   {% include 'header.html'%}
   <!-- MAIN CONTENT-->
   <div class="main-content">
      <div class="section__content section__content--p30">
         <div class="container-fluid">
            <div class="headingrow">
              {% if user.authority != 'Viewer' and user.authority != 'Accounts'%}
               <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#entry0">
               New Entry
               </button>
               {% else %}
               <button type="button" class="btn btn-primary" disabled>
               New Entry
               </button>
               {% endif %}
            </div>
              <div class="headingtitle profit">
            <div class="title">
               <h3>Payment and Finance Details</h3>
            </div>
            <input type="text" placeholder="Filter" class='table-search approved' data-table-search="myTable"></input>
            <select class="form-control searchid" id="dropdownList">
                <option value="trn">By TRN</option>
                <option value="party">By Party</option>
              </select>
               <div class="filter_year">
                  <select class="form-control" id="by_year">
                     <option value="2013">2013</option>
                     <option value="2014">2014</option>
                     <option value="2015">2015</option>
                     <option value="2016">2016</option>
                     <option value="2017">2017</option>
                     <option value="2018">2018</option>
                     <option value="2019">2019</option>
                     <option value="2020">2020</option>
                     <option value="2021">2021</option>
                     <option value="2022">2022</option>
                     <option value="2023">2023</option>
                     <option value="2024">2024</option>
                     <option value="2025">2025</option>
                     <option value="2026">2026</option>
                     <option value="2027">2027</option>
                     <option value="2028">2028</option>
                     <option value="2029">2029</option>
                     <option value="2030">2030</option>
                  </select>
                  <select class="form-control" id="by_month">
                     <option value="1">January</option>
                     <option value="2">February</option>
                     <option value="3">March</option>
                     <option value="4">April</option>
                     <option value="5">May</option>
                     <option value="6">June</option>
                     <option value="7">July</option>
                     <option value="8">August</option>
                     <option value="9">September</option>
                     <option value="10">October</option>
                     <option value="11">November</option>
                     <option value="12">December</option>
                  </select>
                  <button class="btn btn-primary" id="filter_btn">Filter</button>
               </div>


                  <select class="form-control" id="dropdown">
                    <option value="" id="" selected disabled >By Trade</option>
                      <option value="salestrade" id="salestrade">By Sales Trade</option>
                      <option value="purchasetrade" id="purchasetrade">By Purchase Trade</option>
                      <option value="cancelsales" id="cancelsales">By Cancel Sales </option>
                      <option value="cancelpurchase" id="cancelpurchase">By Cancel Purchase</option>
                      <option value="salesamendment" id="salesamendment">By Sales Amendment</option>
                      <option value="purchaseamendment" id="purchaseamendment">By Purchase Amendment</option>
                  </select>
                  </input>
         </div>


            <!-- Modal -->
            <div class="modal fade" id="entry0" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
               <div class="modal-dialog" role="document">
                  <div class="modal-content">
                     <div class="modal-header">
                        <h3 class="modal-title title" id="exampleModalLabel">Payment and Finance Data Entry</h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                     </div>
                     <div class="modal-body">
                        <div class="card-body card-block">
                           <form action="{% url 'home:savepaymentFinance'%}" method="post" class="form-horizontal">
                              {% csrf_token %}
                              <div class="numbertraderef">
                                 <label for="traderefno">Trade Reference Number</label>
                                 <select class="form-control" id="traderefno" name="traderefno">
                                    <option value="trn">select trn</option>
                                    {%for trn in trns %}
                                    {% if trn.trn.trade_status == 'Approved' and trn.reviewed == True %}
                                    <option value="{{trn.trn}}">{{trn.trn}}</option>
                                    {% endif %}
                                    {% endfor %}
                                 </select>
                              </div>
                              <div class="tradeselect">
                                <div class="row form-group">
                                 <div class="col-md-6">
                               <!--      <select class="form-control" id="tradetype-input" name="tradetype-input">
                                       <option value="company" disabled="disabled" selected="true">Select your trade type</option>
                                       <option value="Sales">Sales</option>
                                       <option value="Purchase">Purchase</option>
                                    </select> -->


                             <input type="text" id="tradetype-input" name="tradetype-input" value="Sales"  class="form-control">
                           </div>


                                     <div class="col-md-6">
                                      <input type="text" class="form-control" id="paymentfinanceparty" placeholder="Buyer/ Seller Name" name="paymentfinanceparty">
                                   <!-- <select class="form-control" id="paymentfinance">
                                    <option value="name1" selected disabled>Buyer/Seller Name</option>
                                     <option value="name1">Name1</option>
                                     <option value="name1">Name1</option>
                                     <option value="name1">Name1</option>
                                     <option value="name1">Name1</option>
                                   </select> -->
                                 </div>
                              </div>
                                </div>
                              <div class="row form-group">
                                 <div class="col col-md-4">
                                    <label for="balancepayment-input" class=" form-control-label"><span id="payments">Balance Payment</span></label>
                                    {%if user.authority == 'Manager 2'%}
                                    <input type="text" id="balancepayment-input" name="balancepayment-input" class="validatenum form-control">
                                    {%else%}
                                    <input type="text" id="balancepayment-input" readonly name="balancepayment-input" class="validatenum form-control">
                                    {%endif%}
                                 </div>
                                 <div class="col col-md-4">
                                    <label for="paymentduedate-input" class=" form-control-label"><span id="date">Payment Due Date</span></label>
                                    <!-- <input type="text" class="form-control date" id="paymentduedate-input" name="paymentduedate-input"  placeholder="Choose the date"> -->

                                          <div class="datefield">
                                    <input type="text" class="form-control" name="paymentduedate-input" id="paymentduedate-input">
                                    <span>
                                    <i class="fa fa-calendar date" id="paymentduedate-input-date" ></i>
                                 </span>
                                 </div>


                                 </div>
                                 <div class="col col-md-4">
                                    <label for="payment-input" class=" form-control-label"><span id="payments_made">Payment Received</span></label>
                                    <input type="text" id="payment-input" name="payment-input" class="validatenum form-control">
                                 </div>
                              </div>
                              <div class="row form-group">
                                 <div class="col col-md-4">
                                    <label for="paymentdate-input" class=" form-control-label">Payment Date</label>
                                   <!--  <input type="text" class="form-control date" id="paymentdate-input" name="paymentdate-input"> -->
                                    <div class="datefield">
                                    <input type="text" class="form-control" name="paymentdate-input" id="paymentdate-input">
                                    <span>
                                    <i class="fa fa-calendar date" id="paymentdate-input-date" ></i>
                                 </span>
                                 </div>
                                 </div>
                                 <div class="col col-md-4">
                                    <label for="balancedue-input" class=" form-control-label">Balance Due</label>
                                    <input type="text" id="balancedue-input" name="balancedue-input" class="validatenum form-control">
                                 </div>
                                 <div class="col col-md-4">
                                    <label for="paymentmode-input" class=" form-control-label">Payment Mode</label>
                                    <input type="text" id="paymentmode-input" name="paymentmode-input" id="paymentmode-input" class="form-control">
                                 </div>
                              </div>
                              <div class="row form-group">
                                 <div class="col col-md-6">
                                    <label for="statusofpayments-input" class=" form-control-label">Status of Payments/Maturity/Documents </label>
                                    <input type="text" id="statusofpayments-input" name="statusofpayments-input" class="form-control">
                                 </div>
                                 <div class="col col-md-6">
                                    <label for="saleslogisticpaymenttobepaid-input" class=" form-control-label">Payments of Logistics to be paid</label>
                                    {%if user.authority == 'Manager 2'%}
                                    <input type="text" id="logisticpaymenttobepaid-input" name="logisticpaymenttobepaid-input" class="validatenum form-control">
                                    {%else%}
                                    <input type="text" id="logisticpaymenttobepaid-input" readonly name="logisticpaymenttobepaid-input" class="validatenum form-control">
                                    {%endif%}
                                 </div>
                              </div>
                              <div class="row form-group">
                                 <div class="col col-md-6">
                                    <label for="saleslogisticagent-input" class=" form-control-label">Logistics Provider</label>
                                    {%if user.authority == 'Manager 2'%}
                                    <input type="text" id="logisticagent-input" name="logisticagent-input" class="form-control">
                                    {%else%}
                                    <input type="text" id="logisticagent-input" readonly name="logisticagent-input" class="form-control">
                                    {%endif%}
                                 </div>
                                 <div class="col col-md-6">
                                    <label for="comissionagent-input" class=" form-control-label">Commission Agent</label>
                                    {%if user.authority == 'Manager 2'%}
                                    <input type="text" id="comissionagent-input" name="comissionagent-input" class="form-control">
                                    {%else%}
                                    <input type="text" id="comissionagent-input" readonly name="comissionagent-input" class="form-control">
                                    {%endif%}
                                 </div>
                              </div>
                              <div class="row form-group">
                                 <div class="col col-md-4">
                                    <label for="agent_commissionamountpaid-input" class=" form-control-label">Agent Comission Due</label>
                                    {%if user.authority == 'Manager 2'%}
                                    <input type="text" id="agent_commissionamountpaid-input" name="agent_commissionamountpaid-input" id="agent_commissionamountpaid-input" class="validatenum form-control">
                                    {%else%}
                                    <input type="text" id="agent_commissionamountpaid-input" readonly name="agent_commissionamountpaid-input" id="agent_commissionamountpaid-input" class="validatenum form-control">
                                    {%endif%}
                                 </div>
                                 <div class="col col-md-4">
                                    <label for="salesduedate_logistic_comissions-input" class=" form-control-label">Due Date for Logistics Comissions</label>
                                   <!--  <input type="text" class="form-control date" id="duedate_logistic-agent_comissions-input" name="duedate_logistic-agent_comissions-input"/> -->
                                   <div class="datefield">
                                    <input type="text" class="form-control" name="duedate_logistic_comissions-input" id="duedate_logistic_comissions-input">
                                    <span>
                                    <i class="fa fa-calendar date" id="duedate_logistic_comissions-input-date" ></i>
                                 </span>
                                 </div>
                                 </div>

                                    <div class="col col-md-4">
                                    <label for="salesduedate_agent_comissions-input" class=" form-control-label">Due Date for Agent Comissions</label>
                                   <!--  <input type="text" class="form-control date" id="duedate_logistic-agent_comissions-input" name="duedate_logistic-agent_comissions-input"/> -->
                                   <div class="datefield">
                                    <input type="text" class="form-control" name="duedate_agent_comissions-input" id="duedate_agent_comissions-input">
                                    <span>
                                    <i class="fa fa-calendar date" id="duedate_agent_comissions-input-date" ></i>
                                 </span>
                                 </div>
                                 </div>
                                <div>

                                </div>
                              </div>
                                 <div class="row form-group">
                                <div class="col-md-12">
                                  <label for="salespurchase_remarks-input" class="form-control-label">Remarks</label>
                                  <input type="text" class="form-control" id="salespurchase_remarks-input" name="salespurchase_remarks-input">
                                </div>

                              </div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                 <input type="submit" onclick="return Validate()" class="btn btn-primary"  value="Save Details">
                              </div>
                           </form>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
       </div>

       <div class="boxone drag">
      <div class="scroller">
         <table class="table table0 table-striped table-dark table-bordered tablecolumnfixed" id="myTable">
            <thead>
               <tr>
                  <th scope="col">S.N</th>
                  <th scope="col">Trade Type</th>
                  <th scope="col">Company</th>
                  <th scope="col">TRN</th>
                  <th scope="col">Balance Payment</th>
                  <th scope="col">Payment Due Date</th>
                  <th scope="col">Payment Received/Sent</th>
                  <th scope="col">Payment Date</th>
                  <th scope="col">Balance Due</th>
                  <th scope="col">Buyer/Supplier Name</th>
                  <!-- <th scope="col">Remarks</th> -->
                  <th scope="col">Status</th>
               </tr>
            </thead>

            <tbody id="rowid">
               {% for i in records %}
               <tr>
                  <th scope="row">{{i.trn.sn}}</th>
                  <td>{{i.trn.types}}</td>
                  <td>{{i.trn.company}}</td>
                  <td>{{i.trn.trn}}</td>
                  <td>{{i.balancePayment|floatformat:2}}</td>
                  <td>{{i.dueDate}}</td>
                  <td>{{i.payment|floatformat:2}}</td>
                  <td>{{i.paymentDate}}</td>
                  <td>{{i.balanceDue|floatformat:2}}</td>
                  <td>{{i.trn.client}}</td>
                  <!-- <td>{{i.remarks}}</td> -->
                  <td scope="row">

                    <button type="button" class="btn btn-primary view" value="{{i.trn.trn}}" id="{{i.trn.trn}}" data-toggle="modal" data-target="#view0">View</button>
                    {% if user.authority != 'Admin' or user.authority != 'Viewer'%}
                    <button type="button" class="btn btn-primary editbtn0" value="{{i.trn.trn}}" id="{{i.trn.trn}}" data-toggle="modal" data-target="#edit0">Edit</button>{% endif %}
                    {% if user.authority == 'Manager 2'%}
                     <button type="button" class="btn btn-danger delete" value="{{i.trn.trn}}">Delete</button>
                  </td>
                    {% endif %}
               </tr>
               {% endfor %}
            </tbody>
         </table>
      </div>
</div>

<!-- view -->



<div class="modal fade" id="view0" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title title" id="exampleModalLabel">Payment and Finance Report Detail</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
   <div class="modal-body">
        <div class="card-body card-block">

                                            <div class="displaydata">

                                                <table class="table tableview table-bordered">
                                                  <div class="description companytitle">

                              <ul>
                                 <li>S.N :<span id="sn"></span></li>
                                 <li>Company :<span id="company"></span></li>
                                 <li>Trade Ref. Date :<span id="trd"></span></li>
                                 <li>Trade Ref. No :<span id="trn"></span></li>
                              </ul>
                           </div>

  <tbody>
    <!--  <tr>
      <th scope="col">S.N</th>
 <th scope="row">1</th>
    </tr> -->
    <tr>
           <th scope="col"><span id="supply">Balance Payment</span></th>
 <th scope="row" id="balancePayment"></th>

    </tr>
    <tr>
           <th scope="col"><span id="supplydate">Payment Due Date</span></th>
 <th scope="row" id="dueDate"></th>

    </tr>

    <tr>
          <th scope="col"><span id="supplypayment">Payment Received</span></th>
 <th scope="row" id="payment"></th>

    </tr>
     <tr>
          <th scope="col">Payment Date</span></th>
 <th scope="row" id="paymentDate"></th>

    </tr>
        <tr>
          <th scope="col">Balance Due
</th>
 <th scope="row" id="balanceDue"></th>

    </tr>
        <tr>
          <th scope="col">
Payment Mode</th>
 <th scope="row" id="paymentMode"></th>

    </tr>
        <tr>
          <th scope="col">Status of Payments/Maturity/Documents</th>
 <th scope="row" id="paymentStatus"></th>

    </tr>
        <tr>
          <th scope="col">Payments of Logistics to be paid</th>
 <th scope="row" id="logisticsPaymentDue"></th>

    </tr>
        <tr>
          <th scope="col">Logistics Provider</th>
 <th scope="row" id="logisticsProvider"></th>

    </tr>
        <tr>
          <th scope="col">Commission Agent</th>
 <th scope="row" id="commissionAgent"></th>

    </tr>
    <tr>
          <th scope="col">Agent Comission Due</th>
 <th scope="row" id="agentCommissionPaid"></th>

    </tr>
        <tr>
          <th scope="col">Due Date for Logistics Comissions</th>
 <th scope="row" id="logisticsCommissionDueDate"></th>

    </tr>
    <tr>
          <th scope="col">Due Date for Agent Comissions</th>
 <th scope="row" id="agentCommissionDueDate"></th>

    </tr>

     <tr>
          <th scope="col">Remarks</th>
 <th scope="row" id="viewremarks"></th>

    </tr>

  </tbody>
</table>

      </div>
  </div>
</div>
      <div class="modal-footer">

        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

      </div>
    </div>
  </div>
</div>


<!-- edit -->
   <div class="modal fade" id="edit0" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
         <div class="modal-content">
            <div class="modal-header">
               <h3 class="modal-title title" id="exampleModalLabel">Payment and Finance Data Entry</h3>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true">&times;</span>
               </button>
            </div>
            <div class="modal-body">
               <div class="card-body card-block">
                  <form action="{% url 'home:editFinance'%}" method="post" class="form-horizontal">
                     {% csrf_token %}
                     <div class="numbertraderef">
                        <label for="traderefno">Trade Reference Number</label>
                        <select class="form-control" name="traderefno" id="edit-traderefno">
                           <option value="trn">select trn</option>
                           {%for trn in trns %}
                           <option value="{{trn.trn}}">{{trn.trn}}</option>
                           {% endfor %}
                        </select>
                     </div>
                     <div class="tradeselect">
                       <div class="row form-group">
                        <div class="col-md-6">
                           <!-- <select class="form-control" id="edit-tradetype-input" name="tradetype-input">
                              <option value="company" disabled="disabled" selected="true">Select your trade type</option>
                              <option value="Sales">Sales</option>
                              <option value="Purchase">Purchase</option>
                           </select> -->


                             <input type="text" id="edit-tradetype-input" name="tradetype-input" value="Sales" class="form-control">
                           </div>
                               <div class="col-md-6">
                                <input type="text" class="form-control" id="edit-paymentfinanceparty" name="edit-paymentfinanceparty">
                                   <!-- <select class="form-control" id="edit-paymentfinance">
                                    <option value="name1" selected disabled>Buyer/Seller Name</option>
                                     <option value="name1">Name1</option>
                                     <option value="name1">Name1</option>
                                     <option value="name1">Name1</option>
                                     <option value="name1">Name1</option>
                                   </select> -->
                                 </div>
                        </div>

                     </div>
                     <div class="row form-group">
                        <div class="col col-md-4">
                           <label for="balancepayment-input" class=" form-control-label">Balance Payment</label>
                           {%if user.authority == 'Manager 2' or user.authority == 'Accounts'%}
                           <input type="text" id="edit-balancepayment-input" name="balancepayment-input" class="form-control">
                           {%else%}
                           <input type="text" id="edit-balancepayment-input" readonly name="balancepayment-input" class="form-control">
                           {%endif%}
                        </div>
                        <div class="col col-md-4">
                           <label for="paymentduedate-input" class=" form-control-label">Payment Due Date</label>
                           <!-- <input type="text" class="form-control date" id="edit-paymentduedate-input" name="paymentduedate-input"  placeholder="Choose the date"> -->

                                 <div class="datefield">
                                    <input type="text" class="form-control" name="paymentduedate-input" id="edit-paymentduedate-input">
                                    <span>
                                    <i class="fa fa-calendar date" id="edit-paymentduedate-input-date" ></i>
                                 </span>
                                 </div>
                        </div>
                        <div class="col col-md-4">
                           <label for="payment-input" class=" form-control-label">Payment Received</label>
                           <input type="text" id="edit-payment-input" name="payment-input" class="validatenum form-control">
                        </div>
                     </div>
                     <div class="row form-group">
                        <div class="col col-md-4">
                           <label for="paymentdate-input" class=" form-control-label">Payment Date</label>
                           <input type="text" class="form-control date" id="edit-paymentdate-input" name="paymentdate-input">
                        </div>
                        <div class="col col-md-4">
                           <label for="balancedue-input" class=" form-control-label">Balance Due</label>
                           <input type="text" id="edit-balancedue-input" name="balancedue-input" class="validatenum form-control">
                        </div>
                        <div class="col col-md-4">
                           <label for="paymentmode-input" class=" form-control-label">Payment Mode</label>
                           <input type="text" id="edit-paymentmode-input" name="paymentmode-input" class="form-control">
                        </div>
                     </div>
                     <div class="row form-group">
                        <div class="col col-md-6">
                           <label for="statusofpayments-input" class=" form-control-label">Status of Payments/Maturity/Documents </label>
                           <input type="text" id="edit-statusofpayments-input" name="statusofpayments-input" class="form-control">
                        </div>
                        <div class="col col-md-6">
                           <label for="saleslogisticpaymenttobepaid-input" class=" form-control-label">Payments of Logistics to be paid</label>
                           {%if user.authority == 'Manager 2' or user.authority == 'Accounts'%}
                           <input type="text" id="edit-logisticpaymenttobepaid-input" name="logisticpaymenttobepaid-input" class="validatenum form-control">
                           {%else%}
                           <input type="text" id="edit-logisticpaymenttobepaid-input" readonly name="logisticpaymenttobepaid-input" class="validatenum form-control">
                           {%endif%}
                        </div>
                     </div>
                     <div class="row form-group">
                        <div class="col col-md-6">
                           <label for="saleslogisticagent-input" class=" form-control-label">Logistics Provider</label>
                           {%if user.authority == 'Manager 2' or user.authority == 'Accounts'%}
                           <input type="text" id="edit-logisticagent-input" name="logisticagent-input" class="form-control">
                           {%else%}
                           <input type="text" id="edit-logisticagent-input" readonly name="logisticagent-input" class="form-control">
                           {%endif%}
                        </div>
                        <div class="col col-md-6">
                           <label for="comissionagent-input" class=" form-control-label">Commission Agent</label>
                           {%if user.authority == 'Manager 2' or user.authority == 'Accounts'%}
                           <input type="text" id="edit-comissionagent-input" name="comissionagent-input" class="form-control">
                           {%else%}
                           <input type="text" id="edit-comissionagent-input" readonly name="comissionagent-input" class="form-control">
                           {%endif%}
                        </div>
                     </div>
                     <div class="row form-group">
                         <div class="col col-md-4">
                                    <label for="agent_commissionamountpaid-input" class=" form-control-label">Agent Comission Due</label>
                                    {%if user.authority == 'Manager 2' or user.authority == 'Accounts'%}
                                    <input type="text" id="edit-agent_commissionamountpaid-input" name="agent_commissionamountpaid-input" id="edit-agent_commissionamountpaid-input" class="validatenum form-control">
                                    {%else%}
                                    <input type="text" id="edit-agent_commissionamountpaid-input" readonly name="agent_commissionamountpaid-input" id="edit-agent_commissionamountpaid-input" class="validatenum form-control">
                                    {%endif%}
                                 </div>
                                 <div class="col col-md-4">
                                    <label for="salesduedate_logistic_comissions-input" class=" form-control-label">Due Date for Logistics Comissions</label>
                                   <!--  <input type="text" class="form-control date" id="duedate_logistic-agent_comissions-input" name="duedate_logistic-agent_comissions-input"/> -->
                                   <div class="datefield">
                                    <input type="text" class="form-control" name="duedate_logistic_comissions-input" id="edit-duedate_logistic_comissions-input">
                                    <span>
                                    <i class="fa fa-calendar date" id="edit-duedate_logistic_comissions-input-date" ></i>
                                 </span>
                                 </div>
                                 </div>

                                    <div class="col col-md-4">
                                    <label for="salesduedate_agent_comissions-input" class=" form-control-label">Due Date for Agent Comissions</label>
                                   <!--  <input type="text" class="form-control date" id="duedate_logistic-agent_comissions-input" name="duedate_logistic-agent_comissions-input"/> -->
                                   <div class="datefield">
                                    <input type="text" class="form-control" name="duedate_agent_comissions-input" id="edit-duedate_agent_comissions-input">
                                    <span>
                                    <i class="fa fa-calendar date" id="edit-duedate_agent_comissions-input-date" ></i>
                                 </span>
                                 </div>
                                 </div>

                              </div>
                                   <div class="row form-group">
                                <div class="col-md-12">
                                  <label for="edit-salespurchase_remarks-input" class="form-control-label">Remarks</label>
                                  <input type="text" class="form-control" id="edit-salespurchase_remarks-input" name="salespurchase_remarks-input">
                                </div>

                              </div>
                     <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <input type="submit" onclick="return ValidateEdit()" class="btn btn-primary"  value="Save Details">
                     </div>
                  </form>
               </div>
            </div>
         </div>
      </div>

   </div>
 </div>
</div>
   {% include 'footer.html'%}
 </div>
</div>
   </body>
</html>
<!-- end document-->
